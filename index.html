<!DOCTYPE html>

<html>

	<head>
		<title>Twitch Monitor (PD)</title>

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<link href="https://fonts.googleapis.com/css?family=Play" rel="stylesheet">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
		<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
		<link rel="stylesheet" href="style.css" type="text/css" />
	</head>

	<body>

		<script>

			var channels = ["OgamingSC2", "cretetion", "freecodecamp", "storbeck", "habathcx", "RobotCaleb", "noobs2ninjas","ESL_SC2",];
			var offline = [];
			var online = [];

			function addChannel(index){
				$("#box").append(
					"<div id=\"channel"+index+"\">"+
						"<div class=\"row\">"+
							"<div id=\"channel"+index+"Pic\" class=\"col col-sm-2\">"+
							"</div>"+
							"<div id=\"channel"+index+"Name\" class=\"col col-sm-4\">"+
							"<p>Name"+index+"</p>"+
							"</div>"+
							"<div id=\"channel"+index+"Status\" class=\"col col-sm-6\">"+
							"</div>"+
						"</div>"+
					"</div>"
		    )
			};

			function clearChannels(){
					$('#box').empty();
			}

			function altImg(index) {
			  $("#channel"+index+"Pic").html("<img class="+"logo"+" src=\"http://fie-conference.org/sites/fie-conference.org/files/styles/large/public/placeholder_male1.jpg?itok=6Air5FrM\" alt=\"logo\">");
			};

			function highlight(index){
				$.getJSON("https://wind-bow.gomix.me/twitch-api/streams/" + channels[index] +"?callback=?", function(data) {
				  if (data.stream == null) {
				  	offline.push(index);
				  	$("#channel"+index).addClass("redBackground");
				  }	
				  else{
				  	$("#channel"+index).addClass("greenBackground");
				  	online.push(index);
				  } 
				});		
			}

			function updateInfo(index){
				$.getJSON("https://wind-bow.gomix.me/twitch-api/channels/" + channels[index] +"?callback=?", function(data) {
					$("#channel"+index+"Name").html("<a href="+data.url+">"+channels[index]+"</a>");		  
				  $("#channel"+index+"Pic").html("<img class="+"logo"+" src="+data.logo+" onerror=\"altImg("+index+")\">");
				  if(data.status == null){
				  	$("#channel"+index+"Status").html("<p>No Status Available</p>");	
				  }else{
				  	$("#channel"+index+"Status").html("<p>"+data.status+"</p>");			  
				  }
					highlight(index);
				});
			}

			function populateAll(){
				for (var i = 0; i < channels.length; i++) { 
					addChannel(i);
					updateInfo(i);
				}
			}

			function populateOnline(){
				for (var i = 0; i < online.length; i++) { 
					addChannel(online[i]);
					updateInfo(online[i]);
				}
			}

			function populateOffline(){
				for (var i = 0; i < offline.length; i++) { 
					addChannel(offline[i]);
					updateInfo(offline[i]);
				}
			}
			$(document).ready(function() {

				// BUTTON CONTROLS
				$('#btnAll').on('click', function() {
					clearChannels();
					populateAll();
				});

				$('#btnOnline').on('click', function() {
					clearChannels();
					populateOnline();
				});		

				$('#btnOffline').on('click', function() {
					clearChannels();
					populateOffline();
				});	


				// INITIAL LIST POPULATION
				// populateOnline();
				// populateOffline();
				populateAll();


			});

		</script>


		<div id="main" class="container">	

			<h1>Twitch Monitor</h1>

			<div id="tabs">
				<button id="btnAll" class="btn btnTab">All</button>
				<button id="btnOnline" class="btn btnTab">Online</button>
				<button id="btnOffline" class="btn btnTab">Offline</button>
			</div>

			<div id="box">

				<div id="allBox" class="">
				</div>

				<div id="onlineBox" class="hidden">
				</div>

				<div id="offlineBox" class="hidden">
				</div>

			</div>

		</div>

	</body>

</html>